<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
        }

        /* The grid: Three equal columns that floats next to each other */
        .column {
            float: left;
            left: 0;
            width: 33.3%;
            padding: 50px;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
            color: white;
        }

        .containerTab {
            padding: 20px;
            color: white;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        /* Closable button inside the container tab */
        .closebtn {
            float: right;
            color: white;
            font-size: 35px;
            cursor: pointer;
        }

        table {
            border-collapse: collapse;
            border-spacing: 0;
            width: 100%;
            border: 1px solid #ddd;
        }

        th, td {
            text-align: left;
            padding: 8px;
        }

        table tr:not(:first-child) {
            cursor: pointer;
            transition: all .25s ease-in-out;
        }

        table tr:not(:first-child):hover {
            background-color: #ddd;
        }

        tr:nth-child(even) {
            background-color: black
        }


    </style>
</head>

<body bgcolor="#fff0f5">

<div style="text-align:center">
    <marquee>
        <h1>SALES ORDER</h1>
    </marquee>

</div>

<!-- Three columns -->
<div class="row">
    <div class="column" onclick="openTab('b1');" style="background:lightcoral;">
        Create Product
    </div>
    <div class="column" onclick="openTab('b2')" style="background:lightcoral;">
        Create orders and Associate Product
    </div>
    <div class="column" onclick="openTab('b3')" style="background:lightcoral;">
        View Orders
    </div>

</div>

<!-- Full-width columns: (hidden by default) -->
<div id="b1" class="containerTab" style="display:none;background:brown">
    <span onclick="this.parentElement.style.display='none'" class="closebtn">&times;</span>

    <label for="pcode">Product Code:</label>
    <input type="text" id="pcode" size="25" placeholder="Enter Product Code" required> <br/> <br/>

    <label for="pprice">Product Price:</label>
    <input type="text" id="pprice" size="25" placeholder="Enter Price" required> <br/> <br/>

    <label for="pdescription">Product Description:</label>
    <input type="text" id="pdescription" size="25" placeholder="Enter Description" required> <br/> <br/>
    <button type="button" onclick="createProduct()">Create Product</button>
    <button type="button" onclick="productReset()">Reset</button>


</div>


<div id="b2" class="containerTab" style="display:none;background:brown">
    <span onclick="this.parentElement.style.display='none'" class="closebtn">&times;</span>

    <h2>Please click to view all products to order</h2>
    <button type="submit" onclick="viewProducts()">View All Products</button>

    <div id="viewProduct">
        <p id="showProducts"></p>
    </div>
    <br><br>
    <h> Click on any product in the list above to order below:</h>
    <br><br>

    <label for="productId">Product Code:</label>
    <input type="text" id="productId" size="25" placeholder="Product id" required> <br/> <br/>

    <label for="productCode">Product Code:</label>
    <input type="text" id="productCode" size="25" placeholder="Product code" required> <br/> <br/>

    <label for="productPrice">Product Price:</label>
    <input type="text" id="productPrice" size="25" placeholder="Product price" required> <br/> <br/>

    <label for="productDescription">Product Description:</label>
    <input type="text" id="productDescription" size="25" placeholder="Product description" required> <br/> <br/>

    <br>
    <h>Create Order Below:</h>
    <br>
    <br>
    <label for="code">Order Code:</label>
    <input type="text" id="code" size="25" placeholder="Enter order code" required> <br/> <br/>

    <label for="description">Order Description:</label>
    <input type="text" id="description" size="25" placeholder="Enter order description" required> <br/> <br/>

    <label for="quantity">Quantity:</label>
    <input type="text" id="quantity" size="25" placeholder="Enter quantity" required> <br/> <br/>


    <label for="custName">Customer Name:</label>
    <input type="text" id="custName" size="25" placeholder="Enter customer name" required> <br/> <br/>

    <label for="custAddress">CustomerAddress:</label>
    <input type="text" id="custAddress" size="25" placeholder="Enter customer address" required> <br/> <br/>

    <button type="button" onclick="createOrder()"> Create Order</button>

</div>


<div id="b3" class="containerTab" style="display:none;background:brown">
    <span onclick="this.parentElement.style.display='none'" class="closebtn">&times;</span>
    <button type="button" onclick="viewOrders()">View Orders</button>
    <p id="showData"></p>
    <br><br>
    <div>

        <h>Edit sales order</h>
        <br><br>
        <label for="eId">Order Id:</label>
        <input type="text" id="eId" size="25" placeholder="Enter order Id" required> <br/> <br/>

        <label for="ecode">Order Code:</label>
        <input type="text" id="ecode" size="25" placeholder="Enter order code" required> <br/> <br/>

        <label for="edescription">Order Description:</label>
        <input type="text" id="edescription" size="25" placeholder="Enter order description" required> <br/> <br/>

        <label for="ecustName">Customer Name:</label>
        <input type="text" id="ecustName" size="25" placeholder="Enter customer name" required> <br/> <br/>

        <label for="ecustAddress">Customer Address:</label>
        <input type="text" id="ecustAddress" size="25" placeholder="Enter customer address" required> <br/> <br/>

        <label for="equantity">Quatity:</label>
        <input type="text" id="equantity" size="25" placeholder="Enter quantity" required> <br/> <br/>

        <label for="eProductCode">Product Code:</label>
        <input type="text" id="eProductCode" size="25" placeholder="Enter product Code" readonly="readonly"> <br/> <br/>

        <label for="eProductId">Product Id:</label>
        <input type="text" id="eProductId" size="25" placeholder="Enter product Id" readonly="readonly"> <br/> <br/>


        <label for="eProductDescription">Product Description:</label>
        <input type="text" id="eProductDescription" size="25" placeholder="Enter product description"
               readonly="readonly"><br/> <br/>

        <label for="eProductPrice">Product Price:</label>
        <input type="text" id="eProductPrice" size="25" placeholder="Enter product price" readonly="readonly"> <br/>
        <br/>

        <button type = "button" onclick="edit()">Edit</button>
        <button type = "button" onclick="removeOrder()">Remove</button>
    </div>
</div>

<script>
    function openTab(tabName) {
        var i, x;
        x = document.getElementsByClassName("containerTab");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }
        document.getElementById(tabName).style.display = "block";
    }

    function createOrder() {
        debugger;
        console.log("Create Order");
        var request = new XMLHttpRequest();
        request.open('POST', 'http://localhost:8080/api/v1/order', true);
        var orderCode = document.getElementById('code').value;
        var orderDescription = document.getElementById('description').value;
        var quantity = document.getElementById('quantity').value;
        var customerName = document.getElementById('custName').value;
        var address = document.getElementById('custAddress').value;
        if (orderCode === "") {
            alert("Order Code cannot Be Empty.Please enter order code")
        } else if (orderDescription === "") {
            alert("Order description cannot be empty.Please enter order description")
        } else if (customerName === "") {
            alert("Customer name cannot be empty.Please enter customer name")
        } else if (address === "") {
            alert("Please enter customer address")
        } else if (quantity === "") {
            alert("Please enter quantity of product")
        }
        else {
            var objectData = {
                code: orderDescription,
                description: orderDescription,
                customerName: customerName,
                address: address,
                quantity: quantity,
                product: {
                    id: document.getElementById('productId').value,
                    code: document.getElementById('productCode').value,
                    description: document.getElementById('productDescription').value,
                    price: document.getElementById('productPrice').value
                }


            };
            var myJSON = JSON.stringify(objectData);
            request.setRequestHeader("Content-type", "application/json");
            request.send(myJSON);
            alert("Order Succesfully created!");
        }

    }

    function viewOrders() {
        debugger;
        console.log("View all orders");
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "http://localhost:8080/api/v1/order", true);
        xhttp.send();
        xhttp.onreadystatechange = function () {
            if (this.readyState === 4 && this.status === 200) {

                var jsonString = xhttp.response;
                var obj = JSON.parse(jsonString);
                //EXTRACT VALUE FOR HTML HEADER.
                var col = [];
                for (var i = 0; i < obj.length; i++) {
                    for (var key in obj[i]) {
                        //if key in the json is product ,create  column product description
                        if (key === "product") {
                            var key = ["productCode", "productId", "productDescription", "productPrice"];
                            if (col.indexOf(key[0]) === -1) {
                                col.push(key[0]);
                            }
                            if (col.indexOf(key[1]) === -1) {
                                col.push(key[1]);
                            }
                            if (col.indexOf(key[2]) === -1) {
                                col.push(key[2]);
                            }
                            if (col.indexOf(key[3]) === -1) {
                                col.push(key[3]);
                            }

                        }
                        else if (col.indexOf(key) === -1) {
                            col.push(key);
                        }
                    }
                }
                //CREATE DYNAMIC TABLE.
                var table = document.createElement("table");
                // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
                // TABLE ROW
                var tr = table.insertRow(-1);
                for (var i = 0; i < col.length; i++) {
                    // TABLE HEADER.
                    var th = document.createElement("th");
                    th.innerHTML = col[i];
                    tr.appendChild(th);
                }
                //ADD JSON DATA TO THE TABLE AS ROWS.
                for (var i = 0; i < obj.length; i++) {
                    tr = table.insertRow(-1);
                    for (var j = 0; j < col.length; j++) {
                        var tabCell = tr.insertCell(-1);
                        if (col[j] === "productCode") {
                            tabCell.innerHTML = obj[i].product.code;
                        }
                        else if (col[j] === "productId") {
                            tabCell.innerHTML = obj[i].product.id;
                        }
                        else if (col[j] === "productDescription") {
                            tabCell.innerHTML = obj[i].product.description;
                        }
                        else if (col[j] === "productPrice") {
                            tabCell.innerHTML = obj[i].product.price;
                        }
                        else {
                            tabCell.innerHTML = obj[i][col[j]];
                        }
                    }
                }
                // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
                var divContainer = document.getElementById("showData");
                divContainer.innerHTML = "";
                divContainer.appendChild(table);
                // get selected row
                // display selected row data in text input
                for (var i = 1; i < table.rows.length; i++) {
                    table.rows[i].onclick = function () {
                        rIndex = this.rowIndex;
                        console.log(rIndex);
                        document.getElementById("eId").value = this.cells[0].innerHTML;
                        document.getElementById("ecode").value = this.cells[1].innerHTML;
                        document.getElementById("edescription").value = this.cells[2].innerHTML;
                        document.getElementById("ecustName").value = this.cells[3].innerHTML;
                        document.getElementById("ecustAddress").value = this.cells[4].innerHTML;
                        document.getElementById("eProductCode").value = this.cells[5].innerHTML;
                        document.getElementById("eProductId").value = this.cells[6].innerHTML;
                        document.getElementById("eProductDescription").value = this.cells[7].innerHTML;
                        document.getElementById("eProductPrice").value = this.cells[8].innerHTML;
                        document.getElementById("equantity").value = this.cells[9].innerHTML;
                    };
                }
            }
        }
    }


    function edit() {
        debugger;
        console.log("Edit Order");
        var request = new XMLHttpRequest();
        var id = document.getElementById('eId').value;
        request.open('PUT', 'http://localhost:8080/api/v1/order/' + id, true);
        var objectData = {
            id: id,
            code: document.getElementById('ecode').value,
            description: document.getElementById('edescription').value,
            customerName: document.getElementById('ecustName').value,
            address: document.getElementById('ecustAddress').value,
            quantity: document.getElementById('equantity').value,
            product: {
                id: document.getElementById('eProductId').value,
                code: document.getElementById('eProductCode').value,
                description: document.getElementById('eProductDescription').value,
                price: document.getElementById('eProductPrice').value
            }

        };
        var myJSON = JSON.stringify(objectData);
        request.setRequestHeader("Content-type", "application/json");
        request.send(myJSON);
        alert("Order Updated Successfully");
    }


    function removeOrder() {
        debugger;
        console.log("Remove Order");
        var request = new XMLHttpRequest();
        var id = document.getElementById('eId').value;
        request.open('PUT', 'http://localhost:8080/api/v1/order/remove/' + id, true);
        request.send();
        alert("Order Removed Successfully");

    }
    function productReset() {
        document.getElementById('pcode').value = "";
        document.getElementById('pprice').value = "";
        document.getElementById('pdescription').value = "";
    }

    function createProduct() {
        debugger;
        console.log("Create Product");
        var productCode = document.getElementById('pcode').value;
        var productPrice = document.getElementById('pprice').value;
        var productDescription = document.getElementById('pdescription').value;
        if (productCode === "") {
            alert("Please enter product code")
        }
        else if (productPrice === "") {
            alert("Please enter product price")
        }
        else if (productDescription === "") {
            alert("Please enter product description")
        }
        else {
            var objectData = {
                code: productCode,
                price: productPrice,
                description: productDescription
            };
            var request = new XMLHttpRequest();
            request.open('POST', 'http://localhost:8080/api/v1/product', true);
            var myJSON = JSON.stringify(objectData);
            request.setRequestHeader("Content-type", "application/json");
            request.send(myJSON);
            alert("Product Successfully created!");
            }

    }

    function viewProducts() {
        var x = document.getElementById("viewProduct");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
        debugger;
        console.log("View all orders");
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "http://localhost:8080/api/v1/product", true);
        xhttp.send();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

                var jsonString = xhttp.response;
                var obj = JSON.parse(jsonString);

                //EXTRACT VALUE FOR HTML HEADER.
                //{'product id', 'product code', 'product description'}
                var col = [];
                for (var i = 0; i < obj.length; i++) {
                    for (var key in obj[i]) {
                        if (col.indexOf(key) === -1) {
                            col.push(key);
                        }
                    }
                }

                // CREATE DYNAMIC TABLE.
                var table = document.createElement("table");

                // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
                // TABLE ROW
                var tr = table.insertRow(-1);

                for (var i = 0; i < col.length; i++) {
                    // TABLE HEADER.
                    var th = document.createElement("th");
                    th.innerHTML = col[i];
                    tr.appendChild(th);
                }

                // ADD JSON DATA TO THE TABLE AS ROWS.
                for (var i = 0; i < obj.length; i++) {

                    tr = table.insertRow(-1);

                    for (var j = 0; j < col.length; j++) {
                        var tabCell = tr.insertCell(-1);
                        tabCell.innerHTML = obj[i][col[j]];
                    }
                }

                // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
                var divContainer = document.getElementById("showProducts");
                divContainer.innerHTML = "";
                divContainer.appendChild(table);

                //get selected row
                // display selected row data in text input
                for (var i = 1; i < table.rows.length; i++) {
                    table.rows[i].onclick = function () {
                        rIndex = this.rowIndex;
                        console.log(rIndex);

                        document.getElementById("productId").value = this.cells[0].innerHTML;
                        document.getElementById("productCode").value = this.cells[1].innerHTML;
                        document.getElementById("productPrice").value = this.cells[2].innerHTML;
                        document.getElementById("productDescription").value = this.cells[3].innerHTML;
                    };
                }
            }
        }
    }

</script>


</body>
</html>
